<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		
		<!-- cartodb css -->	<link rel="stylesheet" href="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/themes/css/cartodb.css"></link>
		<!-- cartodb js -->		<script src="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/cartodb.js"></script>
		<!-- leaflet label -->	<script src="https://leaflet.github.io/Leaflet.label/leaflet.label.js"></script> <!-- files necessary for labels in leaflet -->
		
		<!-- jquery -->			<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<!-- global vars -->	<script src="https://caminosdeagua.github.io/project-map/global.js" type="text/javascript" /></script> 
		<!-- dataset!!! -->		<script src="https://caminosdeagua.github.io/project-map/data/project_map_dataset.js" type="text/javascript" /></script>
		
		<!-- All language changes happen here!!!! -->
		<!--------------------------------------------------------------------------------------------------->
		<!-- CSS styles --> 	<link href="styles_English.css" rel="stylesheet" type="text/css"></link>
		<!-- display text -->	<script src="https://caminosdeagua.github.io/project-map/display_English.js" type="text/javascript"></script>
		<!---------------------------------------------------------------------------------------------------->
		
		<!--odometer css	-->	<link rel="stylesheet" href="counter/odometer-theme-default.css" />
		<!--odometer js		-->	<script type="text/javascript" src="https://caminosdeagua.github.io/project-map/counter/odometer.js"></script>

		<div class="inner">
			<p class="odometer" id="current"></p> 
			<!--<p>&nbsp;/&nbsp;</p>
			<p class="odometer" id="goal">202</p>-->
		</div>
		
	</head>
	<body onload="init();">
		<script>
			function init() {
				var duplicateCounter = 0;
				var data = PROJECT_MAP_DATA;	// This grabs the JSON data file. 
				AllData = PROJECT_MAP_DATA
				for (var i=0; i<data.length; i++) { // Loop through all the rows of the data
					if (data[i][DATA_NAMES.name] == null | data[i][DATA_NAMES.name] == "" |	// if there's no date or latLng info, 
						data[i][DATA_NAMES.lat] == null | data[i][DATA_NAMES.lat] == "" |	//	ignore the point!
						data[i][DATA_NAMES.lng] == null | data[i][DATA_NAMES.lng] == "") {
					} else {
						if (i==0 || data[i][DATA_NAMES.name] != data[i-1][DATA_NAMES.name]) {			// if not a duplicate point (special case for 0th point, cause 0-1 does not exist)
							duplicateCounter = 0;
							AllData[i].duplicates = [i]; 		// create a new array in AllData called duplicates to hold indices of duplicates of this point
							used_indices.push(i);
						} else {													// if i is a duplicate
							duplicateCounter = duplicateCounter + 1;				// increment the duplicate counter
							AllData[i-duplicateCounter].duplicates.push(i);
							AllData[i].isDuplicate = true;
							AllData[i-1].isDuplicate = true;
						}
					}
				}
				document.getElementById("current").innerHTML = Number(totalCapacity());
			}
			
			
			
			
			
			
			function totalCapacity() {
				var total = 0
				for (var i=0; i<used_indices.length; i++) {
					total = total + numberWithoutCommas(storageInstalled(used_indices[i]));
				}
				return total;
			}
			
			function storageInstalled(point) {
				var storage = 0;
				var dup;
				for (var i=0; i<AllData[point].duplicates.length; i++) {
					dup = AllData[point].duplicates[i];
					storage = storage + 12000*AllData[dup][DATA_NAMES.no_ferro] + 2500*AllData[dup][DATA_NAMES.no_roto_small] + 10000*AllData[dup][DATA_NAMES.no_roto_big] + 30000*AllData[dup][DATA_NAMES.no_geomembrane] + 80000*AllData[dup][DATA_NAMES.no_underground] + 2000*AllData[dup][DATA_NAMES.no_rainjar];
				}
				storage = numberWithCommas(storage);
				return storage;
			}
			
			function numberWithCommas(x) {
				return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
			}
			
			function numberWithoutCommas(x) {
				return Number(x.replace(/,/g, ''));
			}
		</script>
	</body>
</html>